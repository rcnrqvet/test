<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ｐｕｒｅ　Ｓｃｒｉｐｔｓ - Recoil Control</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

  body {
    margin: 0;
    background: linear-gradient(135deg, #3b006a, #8e00c2);
    font-family: 'Orbitron', sans-serif;
    color: #d6b3ff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    min-height: 100vh;
  }

  header {
    padding: 1.5rem 0;
    font-size: 2.5rem;
    letter-spacing: 0.3em;
    text-shadow: 0 0 10px #c27aff, 0 0 20px #b36aff;
    user-select: none;
  }

  #licenseSection {
    background: rgba(64, 0, 96, 0.7);
    border-radius: 15px;
    padding: 1rem 2rem;
    margin: 1rem;
    width: 95%;
    max-width: 520px;
    box-shadow: 0 0 15px #a65cff;
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    align-items: center;
  }

  #licenseInput {
    flex-grow: 1;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    background: #3a006b;
    color: #d6b3ff;
    box-shadow: inset 0 0 8px #8e00c2;
  }

  #verifyBtn {
    padding: 0.5rem 1.5rem;
    font-size: 1rem;
    background: linear-gradient(45deg, #8e00c2, #b36aff);
    border: none;
    border-radius: 30px;
    color: white;
    cursor: pointer;
    box-shadow: 0 0 15px #b36aff;
    transition: transform 0.2s ease;
  }

  #verifyBtn:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: 0 0 30px #c580ff;
  }

  #verifyBtn:disabled {
    background: gray;
    cursor: not-allowed;
    box-shadow: none;
  }

  #main {
    background: rgba(64, 0, 96, 0.7);
    border-radius: 15px;
    padding: 2rem 3rem;
    margin: 1rem;
    width: 95%;
    max-width: 520px;
    box-shadow: 0 0 20px #a65cff;
  }

  label {
    display: block;
    margin-top: 1.25rem;
    font-weight: 700;
    font-size: 1.1rem;
    text-shadow: 0 0 5px #b77aff;
  }

  select, input[type="range"] {
    width: 100%;
    margin-top: 0.5rem;
    background: #3a006b;
    border: none;
    border-radius: 8px;
    color: #d6b3ff;
    font-size: 1rem;
    padding: 0.5rem;
    outline: none;
    box-shadow: inset 0 0 8px #8e00c2;
  }

  button {
    margin-top: 2rem;
    width: 100%;
    background: linear-gradient(45deg, #8e00c2, #b36aff);
    border: none;
    border-radius: 30px;
    padding: 1rem 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: #fff;
    cursor: pointer;
    box-shadow: 0 0 20px #b36aff;
    transition: transform 0.2s ease;
  }

  button:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: 0 0 40px #c580ff;
  }

  button:disabled {
    background: gray;
    cursor: not-allowed;
    box-shadow: none;
  }

  #status {
    margin-top: 1rem;
    font-size: 0.9rem;
    font-style: italic;
    text-align: center;
    color: #d6b3ffaa;
  }
</style>
</head>
<body>

<header>Ｐｕｒｅ　Ｓｃｒｉｐｔｓ</header>

<div id="licenseSection">
  <input type="text" id="licenseInput" placeholder="Enter your license key here" />
  <button id="verifyBtn">Verify License</button>
</div>

<div id="main">
  <label for="operatorSelect">Select Operator</label>
  <select id="operatorSelect" disabled>
    <option value="default">Default</option>
    <option value="operator1">Operator 1</option>
    <option value="operator2">Operator 2</option>
    <option value="operator3">Operator 3</option>
    <!-- Add real operators here -->
  </select>

  <label for="sensitivityRange">Custom Sensitivity: <span id="sensitivityValue">1.0</span></label>
  <input type="range" id="sensitivityRange" min="0.1" max="5.0" step="0.1" value="1.0" disabled />

  <button id="applyBtn" disabled>Apply Settings</button>

  <div id="status">Please verify your license key to use recoil control.</div>
</div>

<script>
  const ws = new WebSocket("ws://localhost:8765");
  const statusEl = document.getElementById("status");
  const operatorSelect = document.getElementById("operatorSelect");
  const sensitivityRange = document.getElementById("sensitivityRange");
  const sensitivityValue = document.getElementById("sensitivityValue");
  const applyBtn = document.getElementById("applyBtn");
  const licenseInput = document.getElementById("licenseInput");
  const verifyBtn = document.getElementById("verifyBtn");

  let licenseValid = false;

  sensitivityRange.addEventListener('input', () => {
    sensitivityValue.textContent = sensitivityRange.value;
  });

  ws.onopen = () => {
    statusEl.textContent = "Connected to backend. Please verify your license key.";
  };

  ws.onclose = () => {
    statusEl.textContent = "Disconnected from backend. Please start backend.";
    disableControls();
  };

  ws.onerror = () => {
    statusEl.textContent = "Error connecting to backend.";
    disableControls();
  };

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      if (data.action === "license_result") {
        if (data.ok) {
          licenseValid = true;
          statusEl.textContent = "License verified! You can now use recoil control.";
          enableControls();
        } else {
          licenseValid = false;
          statusEl.textContent = `License invalid: ${data.msg}`;
          disableControls();
        }
      }
    } catch {
      // Not JSON, ignore or handle other message types
      console.log("Received:", event.data);
    }
  };

  function enableControls() {
    operatorSelect.disabled = false;
    sensitivityRange.disabled = false;
    applyBtn.disabled = false;
  }

  function disableControls() {
    operatorSelect.disabled = true;
    sensitivityRange.disabled = true;
    applyBtn.disabled = true;
  }

  verifyBtn.onclick = () => {
    const key = licenseInput.value.trim();
    if (key.length === 0) {
      alert("Please enter a license key.");
      return;
    }
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify({ action: "verify", key }));
      statusEl.textContent = "Verifying license key...";
    } else {
      statusEl.textContent = "WebSocket not connected.";
    }
  };

  applyBtn.onclick = () => {
    if (!licenseValid) {
      alert("You must verify your license key first.");
      return;
    }
    const operator = operatorSelect.value;
    const sensitivity = parseFloat(sensitivityRange.value);

    // Compose your recoil control message format
    let recoilX = 5 * sensitivity;
    let recoilY = 10 * sensitivity;
    let fireDelay = 0.05;

    const message = `${fireDelay},${recoilX},${recoilY}`;
    ws.send(message);

    statusEl.textContent = `Settings applied: Operator=${operator}, Sensitivity=${sensitivity}`;
  };
</script>

</body>
</html>
