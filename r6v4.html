<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ｐｕｒｅ　Ｓｃｒｉｐｔｓ - Recoil Control</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

  body {
    margin: 0;
    background: linear-gradient(135deg, #3b006a, #8e00c2);
    font-family: 'Orbitron', sans-serif;
    color: #d6b3ff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    min-height: 100vh;
  }

  header {
    padding: 1.5rem 0;
    font-size: 2.5rem;
    letter-spacing: 0.3em;
    text-shadow: 0 0 10px #c27aff, 0 0 20px #b36aff;
    user-select: none;
  }

  #main {
    background: rgba(64, 0, 96, 0.7);
    border-radius: 15px;
    padding: 2rem 3rem;
    margin: 2rem;
    width: 95%;
    max-width: 520px;
    box-shadow: 0 0 20px #a65cff;
  }

  label {
    display: block;
    margin-top: 1.25rem;
    font-weight: 700;
    font-size: 1.1rem;
    text-shadow: 0 0 5px #b77aff;
  }

  select, input[type="range"], input[type="text"] {
    width: 100%;
    margin-top: 0.5rem;
    background: #3a006b;
    border: none;
    border-radius: 8px;
    color: #d6b3ff;
    font-size: 1rem;
    padding: 0.5rem;
    outline: none;
    box-shadow: inset 0 0 8px #8e00c2;
  }

  button {
    margin-top: 2rem;
    width: 100%;
    background: linear-gradient(45deg, #8e00c2, #b36aff);
    border: none;
    border-radius: 30px;
    padding: 1rem 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: #fff;
    cursor: pointer;
    box-shadow: 0 0 20px #b36aff;
    transition: transform 0.2s ease;
  }

  button:hover:enabled {
    transform: scale(1.05);
    box-shadow: 0 0 40px #c580ff;
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
  }

  #status {
    margin-top: 1rem;
    font-size: 0.9rem;
    font-style: italic;
    text-align: center;
    color: #d6b3ffaa;
  }
</style>
</head>
<body>

<header>Ｐｕｒｅ　Ｓｃｒｉｐｔｓ</header>

<div id="main">

  <!-- License Section -->
  <label for="licenseInput">Enter License Key</label>
  <input type="text" id="licenseInput" placeholder="XXXX-XXXX-XXXX-XXXX" autocomplete="off" />
  <button id="verifyBtn">Verify License</button>
  <div id="licenseStatus" style="margin-top: 0.5rem; font-style: normal; color: #ff6666;"></div>

  <!-- Settings, initially disabled -->
  <label for="operatorSelect">Select Operator</label>
  <select id="operatorSelect" disabled>
    <option value="default">Default</option>
    <option value="operator1">Operator 1</option>
    <option value="operator2">Operator 2</option>
    <option value="operator3">Operator 3</option>
    <!-- Add real operators here -->
  </select>

  <label for="sensitivityRange">Custom Sensitivity: <span id="sensitivityValue">1.0</span></label>
  <input type="range" id="sensitivityRange" min="0.1" max="5.0" step="0.1" value="1.0" disabled />

  <button id="applyBtn" disabled>Apply Settings</button>

  <div id="status">Connecting to backend...</div>
</div>

<script>
  const ws = new WebSocket("ws://localhost:8765");
  const statusEl = document.getElementById("status");
  const licenseInput = document.getElementById("licenseInput");
  const verifyBtn = document.getElementById("verifyBtn");
  const licenseStatus = document.getElementById("licenseStatus");

  const operatorSelect = document.getElementById("operatorSelect");
  const sensitivityRange = document.getElementById("sensitivityRange");
  const sensitivityValue = document.getElementById("sensitivityValue");
  const applyBtn = document.getElementById("applyBtn");

  sensitivityRange.addEventListener('input', () => {
    sensitivityValue.textContent = sensitivityRange.value;
  });

  // Disable controls initially until license is verified
  function setControlsEnabled(enabled) {
    operatorSelect.disabled = !enabled;
    sensitivityRange.disabled = !enabled;
    applyBtn.disabled = !enabled;
  }
  setControlsEnabled(false);

  ws.onopen = () => {
    statusEl.textContent = "Connected to backend.";
  };

  ws.onclose = () => {
    statusEl.textContent = "Disconnected. Please start backend.";
    setControlsEnabled(false);
  };

  ws.onerror = () => {
    statusEl.textContent = "Error connecting to backend.";
    setControlsEnabled(false);
  };

  ws.onmessage = (event) => {
    try {
      const msg = JSON.parse(event.data);
      if (msg.action === "license_result") {
        if (msg.ok) {
          licenseStatus.style.color = "#7cff7c";
          licenseStatus.textContent = "License Verified! You may use the tool.";
          setControlsEnabled(true);
          verifyBtn.disabled = true;
          licenseInput.disabled = true;
        } else {
          licenseStatus.style.color = "#ff6666";
          licenseStatus.textContent = `License Invalid: ${msg.msg || "Unknown error"}`;
          setControlsEnabled(false);
        }
      }
    } catch {
      console.log("Received non-JSON message:", event.data);
    }
  };

  verifyBtn.onclick = () => {
    const key = licenseInput.value.trim();
    if (!key) {
      licenseStatus.style.color = "#ff6666";
      licenseStatus.textContent = "Please enter a license key.";
      return;
    }
    licenseStatus.style.color = "#d6b3ff";
    licenseStatus.textContent = "Verifying license...";
    ws.send(JSON.stringify({ action: "verify", key }));
  };

  applyBtn.onclick = () => {
    const operator = operatorSelect.value;
    const sensitivity = parseFloat(sensitivityRange.value);

    // Compose your recoil control message format
    // Example: delay, recoilX, recoilY (dummy values here, adjust as backend expects)
    // For demo, sensitivity is multiplied into recoilY for example
    let recoilX = 5 * sensitivity;
    let recoilY = 10 * sensitivity;
    let fireDelay = 0.05; // example delay

    // Send data to backend, comma-separated
    const message = `${fireDelay},${recoilX},${recoilY}`;
    ws.send(message);

    statusEl.textContent = `Settings applied: Operator=${operator}, Sensitivity=${sensitivity}`;
  };
</script>

</body>
</html>
